# Configuration file for Snakemake Pipeline
# miRNA Oxidation Analysis Pipeline
#
# Test configuration with actual data files

# Project information
project:
  name: "miRNA Oxidation Analysis"
  version: "1.0.0"
  description: "Reproducible pipeline for analyzing G>T oxidation patterns in miRNAs"

# Paths (using relative paths for portability)
paths:
  # IMPORTANTE: snakemake_dir debe ser "." (directorio actual donde estÃ¡ Snakefile)
  # project_root es relativo desde snakemake_pipeline/ hacia arriba
  project_root: "../.."
  snakemake_dir: "."
  
  # Input data - Using relative paths from snakemake_pipeline/
  # NOTE: If data is in a different location, use absolute paths or adjust relative path
  data:
    # Raw data file (original miRNA_count.Q33.txt format)
    # Path relativo: sube 3 niveles (snakemake_pipeline -> pipeline_definitivo -> final_analysis -> 8OG) y entra a organized/
    raw: "../../../organized/02_data/Magen_ALS-bloodplasma/miRNA_count.Q33.txt"
    
    # Processed data (after split-collapse, for Step 1)
    # Using the raw data file (will be processed by pipeline)
    processed_clean: "../../../organized/02_data/Magen_ALS-bloodplasma/miRNA_count.Q33.txt"
    
    # Original data for Step 1.5 (VAF filtering - needs SNV + total counts)
    # Using the same file (it has both SNV and total counts in the format)
    step1_original: "../../../organized/02_data/Magen_ALS-bloodplasma/miRNA_count.Q33.txt"
    
    # Sample metadata file (OPTIONAL - will use pattern matching if not provided)
    metadata: null  # Pattern matching will identify ALS vs Control from sample names
  
  # Output directories (relative to snakemake_dir)
  # IMPORTANTE: Cambiado de "outputs/" a "results/" para consistencia con estructura real
  outputs:
    step1: "results/step1"
    step1_5: "results/step1_5"
    step2: "results/step2"
    step3: "results/step3"  # Clustering (Structure Discovery)
    step4: "results/step4"  # Family Analysis
    step5: "results/step5"  # Expression-Oxidation Correlation
    step6: "results/step6"  # Functional Analysis
    step7: "results/step7"  # Biomarker Analysis (Final Integration)
    step8: "results/step8"  # Sequence-Based Analysis (Paper Reference Methods)
  
  # Scripts directories (relative to snakemake_dir - usually no need to change)
  scripts:
    step1: "scripts/step1"
    step1_5: "scripts/step1_5"
    step2: "scripts/step2"
    step3: "scripts/step3"  # Clustering (Structure Discovery)
    step4: "scripts/step4"  # Family Analysis
    step5: "scripts/step5"  # Expression-Oxidation Correlation
    step6: "scripts/step6"  # Functional Analysis
    step7: "scripts/step7"  # Biomarker Analysis (Final Integration)
    step8: "scripts/step8"  # Sequence-Based Analysis (Paper Reference Methods)
    utils: "scripts/utils"
  
  # Viewers directory (relative to snakemake_dir)
  viewers: "viewers"

# Analysis parameters
analysis:
  # VAF filtering threshold (VAFs >= this value are filtered as technical artifacts)
  vaf_filter_threshold: 0.5  # Filter VAFs > 50%
  
  # Statistical parameters
  alpha: 0.05  # Significance threshold
  fdr_method: "BH"  # FDR correction method
  
  # Log2FC thresholds (step-specific thresholds for different analysis stages)
  # See docs/DECISIONES_DISENO.md for detailed rationale
  log2fc_threshold_step2: 0.58  # Step 2: Exploratory threshold (1.5x fold change)
  log2fc_threshold_step3: 1.0   # Step 3: Clustering threshold (2x fold change, more stringent)
  log2fc_threshold_step6: 1.0   # Step 6: Functional analysis threshold (2x fold change, more stringent)
  
  # Seed region definition
  seed_region:
    start: 2
    end: 8
  
  # Heatmap filtering thresholds (for Figures 2.4 and 2.5)
  # These replace the hardcoded "top 50" or "all 301" approach
  # All miRNAs passing ALL thresholds will be included
  heatmap_filtering:
    # Expression level (RPM - Reads Per Million)
    # Common threshold: RPM > 1 (based on literature: miRNA expression analysis)
    # Set to null to disable RPM filtering (if RPM data not available)
    min_rpm_mean: null  # null = disabled, or value like 1.0, 0.5, etc.
    min_rpm_median: null  # Alternative: use median RPM instead of mean
    
    # VAF thresholds (Variant Allele Frequency)
    min_mean_vaf: 0.0  # Minimum mean VAF across samples (to filter low-expression noise)
    min_samples_with_vaf: 1  # Minimum number of samples where VAF > 0 (detection threshold)
    max_vaf_threshold: 0.5  # Maximum VAF (already filtered in Step 1.5, but can be used here too)
    
    # Seed region requirement
    require_seed_gt: true  # If true, only include miRNAs with G>T in seed region (positions 2-8)
    seed_positions: [2, 3, 4, 5, 6, 7, 8]  # Seed region positions
    
    # Statistical significance (optional - can be combined with other filters)
    require_significance: false  # If true, only include miRNAs with significant differences (p < alpha)
    significance_method: "fdr"  # "fdr" (FDR < alpha) or "pvalue" (p-value < alpha)
    
    # Position filtering
    position_range: null  # null = all positions, or [min, max] like [1, 23] or [2, 8] for seed only
    
    # Additional filters
    min_total_gt_count: null  # Minimum total G>T counts across all samples (if available)
    min_log2_fold_change: null  # Minimum log2 fold change (if doing differential analysis)
  
  # Enrichment analysis filtering (for Figure 2.12 - replaces "top 20/10" arbitrary thresholds)
  enrichment_filtering:
    # G>T burden threshold (total sum of VAF across all samples)
    min_gt_burden: 0.0  # Minimum total G>T burden (sum of VAF)
    min_mean_vaf: 0.0   # Minimum mean VAF across samples
    min_samples_detected: 1  # Minimum number of samples where G>T is detected
    max_cv: null  # Maximum coefficient of variation (null = no CV filter, or value like 1000)
  
  # Statistical assumptions validation
  assumptions:
    check_normality: true  # Perform normality tests (Shapiro-Wilk, KS)
    check_variance_homogeneity: true  # Perform variance homogeneity tests (Levene's, Bartlett's)
    generate_diagnostic_plots: true  # Generate Q-Q plots and histograms
    auto_select_test: true  # Automatically select parametric vs non-parametric test
  
  # Batch effect analysis and correction
  batch_correction:
    method: "none"  # Options: "none", "mean_centering", "combat", "limma"
    pvalue_threshold: 0.05  # p-value threshold for detecting batch effects
  
  # Confounder analysis and control
  confounders:
    adjust: true  # Whether to adjust for confounders in models
    variables: ["age", "sex"]  # List of confounders to analyze/adjust for
  
  # Visualization colors
  colors:
    gt: "#D62728"  # Red for G>T (oxidation)
    control: "grey60"  # Grey for control
    als: "#D62728"  # Red for ALS
  
  # Figure settings (for publication-quality figures)
  figure:
    dpi: 300  # High resolution for publications
    width: 12  # Default width in inches
    height: 10  # Default height in inches
    units: "in"

# Resources
resources:
  # Number of threads for parallel execution
  threads: 4
  
  # Memory requirements (in GB)
  memory_gb: 8

# Conda environments (usually no need to change)
conda_envs:
  r_base: "envs/r_base.yaml"
  r_analysis: "envs/r_analysis.yaml"
